<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Infinity Admin Console</title>
  <style>
    body { background:#05060b; color:#f5f7fb; font-family:Segoe UI, Helvetica Neue, sans-serif; }
    .page { max-width:1200px; margin:0 auto; padding:20px; }
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
    .title { font-weight:700; font-size:18px; }
    .controls { display:flex; gap:8px; }
    select, button { background:#0c0e16; color:#f5f7fb; border:1px solid rgba(255,255,255,0.08); padding:8px 12px; border-radius:6px; }
    .grid { display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; }
    .card { background:#0c0e16; border:1px solid rgba(255,255,255,0.06); border-radius:10px; padding:12px; }
    .card .title { font-size:14px; font-weight:600; margin-bottom:8px; }
    .item { display:flex; justify-content:space-between; align-items:center; padding:8px; border-radius:8px; }
    .item .name { font-weight:600; }
    .item .badge { font-size:12px; padding:4px 8px; border-radius:999px; }
    .badge.green { background:rgba(0,200,83,0.2); color:#00C853; border:1px solid rgba(0,200,83,0.4); }
    .badge.yellow { background:rgba(255,193,7,0.2); color:#FFC107; border:1px solid rgba(255,193,7,0.4); }
    .badge.red { background:rgba(244,67,54,0.2); color:#F44336; border:1px solid rgba(244,67,54,0.4); }
    .section-title { font-size:13px; font-weight:700; margin:16px 0 8px; color:#9aa2b8; }
    .quality { font-size:12px; color:#9aa2b8; }
    .rec { background:#0c0e16; border:1px dashed rgba(255,255,255,0.12); padding:10px; border-radius:8px; margin-top:8px; }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="title">Infinity Admin Console</div>
      <div class="controls">
        <select id="complianceLevel">
          <option value="strict">Compliance: Strict</option>
          <option value="minimal">Compliance: Minimal</option>
          <option value="off">Compliance: Off</option>
        </select>
        <button onclick="applyCompliance()">Apply</button>
        <button onclick="refreshStatus()">Refresh</button>
      </div>
    </div>

    <div id="status"></div>
    <div class="section-title">Recommendations</div>
    <div id="recs"></div>
  </div>

  <script>
    async function refreshStatus() {
      const res = await fetch('/admin/status');
      const data = await res.json();
      const container = document.getElementById('status');
      container.innerHTML = '';

      const grid = document.createElement('div');
      grid.className = 'grid';

      for (const [cat, payload] of Object.entries(data.categories)) {
        const card = document.createElement('div');
        card.className = 'card';
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = `${cat} — Quality ${payload.quality}`;
        card.appendChild(title);
        payload.items.forEach(item => {
          const row = document.createElement('div');
          row.className = 'item';
          const left = document.createElement('div'); left.className = 'name'; left.textContent = item.name;
          const right = document.createElement('div'); right.className = 'badge ' + item.color; right.textContent = item.color.toUpperCase();
          row.appendChild(left); row.appendChild(right);
          card.appendChild(row);
        });
        grid.appendChild(card);
      }
      container.appendChild(grid);

      // Load recs
      const recRes = await fetch('/admin/recommendations');
      const recData = await recRes.json();
      const recBox = document.getElementById('recs');
      recBox.innerHTML = '';
      recData.recommendations.forEach(r => {
        const div = document.createElement('div');
        div.className = 'rec';
        div.textContent = `${r.severity.toUpperCase()}: ${r.area} — ${r.action}`;
        recBox.appendChild(div);
      });
    }

    async function applyCompliance() {
      const level = document.getElementById('complianceLevel').value;
      const res = await fetch(`/admin/settings/compliance?level=${encodeURIComponent(level)}`, { method: 'POST' });
      if (res.ok) {
        alert('Compliance level updated to ' + level);
      } else {
        alert('Failed to update compliance');
      }
    }

    refreshStatus();
    setInterval(refreshStatus, 8000);
  </script>
</body>
</html>
